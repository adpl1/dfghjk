<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Ø¹Ù…ÙŠÙ„</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body {margin:0;font-family:sans-serif;background:#f0f2f5;padding-bottom:60px;}
    .header {background:#4e54c8;color:#fff;padding:1rem;text-align:center;font-size:1.5rem;}
    .content {padding:1rem;}
    textarea {width:100%;height:120px;padding:.75rem;border:1px solid #ccc;border-radius:.5rem;}
    button {display:block;width:100%;padding:.75rem;margin-top:1rem;background:#4e54c8;color:#fff;border:none;border-radius:.5rem;font-size:1rem;cursor:pointer;}
    nav.bottom-nav {position:fixed;bottom:0;left:0;width:100%;height:50px;background:#fff;box-shadow:0 -2px 5px rgba(0,0,0,0.1);display:flex;justify-content:space-around;align-items:center;z-index:100;}
    nav.bottom-nav a {text-decoration:none;color:#555;font-size:1.2rem;}
    nav.bottom-nav a.active {color:#4e54c8;}
  </style>
</head>
<body>
  <div class="header">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</div>
  <div class="content">
    <h2>Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨Ùƒ:</h2>
    <textarea id="order-text" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ù‡Ù†Ø§..."></textarea>
    <button type="button" id="sendBtn" disabled>Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
  </div>

  <nav class="bottom-nav">
    <a href="client_home.html" class="active">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    <a href="account.html">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</a>
  </nav>

  <script>
    // ØªØ¹Ø±ÙŠÙ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyC2H29RVbmSd9nzqmcP_e7bBgty3AEdC3I",
      authDomain: "ssrt-8175a.firebaseapp.com",
      projectId: "ssrt-8175a",
      storageBucket: "ssrt-8175a.appspot.com",
      messagingSenderId: "495122733304",
      appId: "1:495122733304:web:32adde3b3b63214ae5830d"
    };
    // ØªÙ‡ÙŠØ¦Ø© Firebase
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    auth.onAuthStateChanged(user => {
      if (!user) {
        // Ø¥Ù† Ù„Ù… ÙŠÙƒÙ† Ù…Ø³Ø¬Ù„Ø§Ù‹ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        window.location = 'index.html';
      } else {
        currentUser = user;
        console.log('ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙ„:', user.uid);
        // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¬Ù„Ø³Ø©
        document.getElementById('sendBtn').disabled = false;
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.getElementById('sendBtn');
      btn.addEventListener('click', e => {
        e.preventDefault();
        console.log('ğŸ“¤ sendOrder called');
        const text = document.getElementById('order-text').value.trim();
        console.log('ğŸ“ Ù†Øµ Ø§Ù„Ø·Ù„Ø¨:', text);
        if (!text) {
          alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨');
          return;
        }
        if (!currentUser) {
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„.');
          return;
        }
        // Ø¥Ø¶Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø°Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨
        // ...
// ...
db.collection('orders').add({
  uid: currentUser.uid,
  text,
  status: 'pending',
  timestamp: Date.now()
})
.then(docRef => {
  console.log('âœ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø¨Ø±Ù‚Ù…:', docRef.id);
  // Ø£Ø±Ø³Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ø·Ù„Ø¨ (orderId) Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  window.location = `waiting.html?orderId=${docRef.id}`;
})
// ...

        .catch(err => {
          console.error('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨:', err);
          alert('ÙØ´Ù„ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + err.message);
        });
      });
    });
  </script>
</body>
</html>
